OCR SETUP GUIDE 



PATCH:
diff --git a/OCR_SETUP_GUIDE.md b/OCR_SETUP_GUIDE.md
--- a/OCR_SETUP_GUIDE.md
+++ b/OCR_SETUP_GUIDE.md
@@ -1,133 +1,162 @@
-# ðŸ” Guia de ConfiguraÃ§Ã£o OCR - Atalhos Corrigidos
-
-## âœ… CorreÃ§Ãµes Implementadas
-
-Os atalhos de OCR foram **completamente corrigidos e estabilizados** para funcionar em **Macs Apple Silicon com Homebrew**:
-
-- **â‡§ âŒƒ âŒ˜ R** â€“ OCR da Ã¡rea da tela (captura interativa)
-- **â‡§ âŒƒ âŒ˜ F** â€“ OCR de imagem no clipboard
-
-## ðŸ› ï¸ InstalaÃ§Ã£o ObrigatÃ³ria
-
-### 1. Instalar Tesseract via Homebrew
-
-```bash
-# Instalar Tesseract com suporte a idiomas
-brew install tesseract tesseract-lang
-
-# Verificar instalaÃ§Ã£o
-tesseract --version
-```
-
-### 2. Configurar PermissÃµes do Sistema
-
-1. Abra **ConfiguraÃ§Ãµes do Sistema**
-2. VÃ¡ em **Privacidade e SeguranÃ§a**
-3. Clique em **GravaÃ§Ã£o de Tela**
-4. Adicione **Hammerspoon** Ã  lista
-5. **Reinicie o Hammerspoon**
-
-## ðŸ”§ Melhorias Implementadas
-
-### âœ… DetecÃ§Ã£o AutomÃ¡tica de Arquitetura
-- **Apple Silicon (M1/M2/M3)**: Busca Tesseract em `/opt/homebrew/bin/`
-- **Intel Macs**: Busca Tesseract em `/usr/local/bin/`
-- **Fallback**: Tenta caminhos alternativos automaticamente
-
-### âœ… ConfiguraÃ§Ãµes Otimizadas do Tesseract
-- **Idiomas**: PortuguÃªs + InglÃªs (`-l por+eng`)
-- **PSM Mode**: `--psm 6` (bloco uniforme de texto)
-- **OCR Engine**: `--oem 3` (LSTM + Legacy)
-- **Tratamento de Erros**: Mensagens claras e instruÃ§Ãµes de correÃ§Ã£o
-
-### âœ… Fallback Robusto
-- **Primeira opÃ§Ã£o**: Tesseract (mais preciso)
-- **Segunda opÃ§Ã£o**: Vision API nativo do macOS
-- **Tratamento**: Mensagens de erro informativas com soluÃ§Ãµes
-
-### âœ… Suporte Expandido de Formatos
-- **Imagens**: PNG, JPG, JPEG, GIF, BMP, TIFF, WebP
-- **Documentos**: PDF (novo!)
-
-### âœ… Tratamento Correto de CÃ³digos de Retorno
-- **CÃ³digo 0**: Captura bem-sucedida â†’ Processa OCR
-- **CÃ³digo 1**: UsuÃ¡rio cancelou (ESC) â†’ Mensagem "Captura cancelada"
-- **Outros cÃ³digos**: Erro real â†’ Mensagem de permissÃ£o e abre configuraÃ§Ãµes
-
-### âœ… Workflow Simplificado
-- **â‡§ âŒƒ âŒ˜ R**: Captura Ã¡rea da tela â†’ clipboard â†’ OCR
-- **â‡§ âŒƒ âŒ˜ F**: OCR direto do que estÃ¡ no clipboard
-- **Uso de hs.task**: ExecuÃ§Ã£o assÃ­ncrona sem travamentos
-
-## ðŸš€ Como Usar
-
-### OCR de Ãrea da Tela (â‡§ âŒƒ âŒ˜ R)
-
-1. **OpÃ§Ã£o 1 - Captura da Tela**:
-   - Pressione `â‡§ âŒƒ âŒ˜ R`
-   - Selecione Ã¡rea da tela com texto
-   - Texto Ã© extraÃ­do e copiado automaticamente
-
-2. **OpÃ§Ã£o 2 - Imagem da Ãrea de TransferÃªncia**:
-   - Copie uma imagem (âŒ˜C)
-   - Pressione `â‡§ âŒƒ âŒ˜ R`
-   - Texto da imagem Ã© extraÃ­do
-
-### OCR de Imagem no Clipboard (â‡§ âŒƒ âŒ˜ F)
-
-1. Copie qualquer imagem (âŒ˜C) - do Preview, Finder, navegador, etc.
-2. Pressione `â‡§ âŒƒ âŒ˜ F`
-3. Texto da imagem Ã© extraÃ­do e copiado automaticamente
-
-## ðŸ” Teste de ConfiguraÃ§Ã£o
-
-Execute este comando no Terminal para verificar se tudo estÃ¡ configurado:
-
-```bash
-# Verificar Tesseract
-which tesseract && tesseract --version
-
-# Verificar idiomas instalados
-tesseract --list-langs
-```
-
-## âš ï¸ SoluÃ§Ã£o de Problemas
-
-### "OCR falhou ou nenhum texto encontrado"
-
-**Causa**: Tesseract nÃ£o instalado ou nÃ£o encontrado
-
-**SoluÃ§Ã£o**:
-```bash
-brew install tesseract tesseract-lang
-```
-
-### "Falha na captura"
-
-**Causa**: PermissÃµes de gravaÃ§Ã£o de tela nÃ£o configuradas
-
-**SoluÃ§Ã£o**:
-1. ConfiguraÃ§Ãµes â†’ Privacidade â†’ GravaÃ§Ã£o de Tela
-2. Adicionar Hammerspoon
-3. Reiniciar Hammerspoon
-
-### Tesseract nÃ£o encontrado em Apple Silicon
-
-**Causa**: Caminho incorreto
-
-**SoluÃ§Ã£o**: O cÃ³digo agora detecta automaticamente:
-- `/opt/homebrew/bin/tesseract` (Apple Silicon)
-- `/usr/local/bin/tesseract` (Intel)
-
-## ðŸ“Š Recursos TÃ©cnicos
-
-- **DetecÃ§Ã£o automÃ¡tica de arquitetura** (Apple Silicon vs Intel)
-- **MÃºltiplos engines OCR** (Tesseract + Vision API)
-- **ConfiguraÃ§Ãµes otimizadas** para melhor precisÃ£o
-- **Tratamento robusto de erros** com mensagens claras
-- **Suporte a mÃºltiplos formatos** de imagem
-- **OrganizaÃ§Ã£o inteligente de texto** por posiÃ§Ã£o vertical
-
-## âœ¨ Resultado
-
-ApÃ³s as correÃ§Ãµes, os atalhos OCR agora funcionam de forma **estÃ¡vel e confiÃ¡vel** em Macs Apple Silicon com Homebrew, com fallbacks robustos e mensagens de erro informativas.
+# ðŸ” Guia de ConfiguraÃ§Ã£o OCR - Atalhos Corrigidos
+
+## âœ… CorreÃ§Ãµes Implementadas (Atualizado)
+
+Os atalhos de OCR foram **completamente corrigidos e estabilizados** para funcionar em **Macs Apple Silicon com Homebrew**:
+
+### ðŸ”§ Problema Identificado e Corrigido (SOLUÃ‡ÃƒO FINAL)
+**Problema**: O atalho `â‡§ âŒƒ âŒ˜ R` apenas copiava a imagem para o clipboard sem executar o OCR.
+
+**Causa Raiz**: O `screencapture -i -c` salvava a imagem no clipboard, mas depois o OCR tambÃ©m tentava usar o clipboard, causando conflito. A imagem capturada sobrescrevia o texto extraÃ­do pelo OCR.
+
+**SoluÃ§Ã£o Final**: 
+1. **MudanÃ§a de abordagem**: Em vez de usar `screencapture -i -c` (clipboard), agora usa `screencapture -i arquivo.png` (arquivo temporÃ¡rio)
+2. **Fluxo corrigido**: Captura â†’ Arquivo temporÃ¡rio â†’ OCR â†’ Texto no clipboard (sem interferÃªncia da imagem)
+3. **Limpeza automÃ¡tica**: O arquivo temporÃ¡rio Ã© removido automaticamente apÃ³s o OCR
+
+- **â‡§ âŒƒ âŒ˜ R** â€“ OCR da Ã¡rea da tela (captura interativa)
+- **â‡§ âŒƒ âŒ˜ F** â€“ OCR de imagem no clipboard
+
+## ðŸ› ï¸ InstalaÃ§Ã£o ObrigatÃ³ria
+
+### 1. Instalar Tesseract via Homebrew
+
+```bash
+# Instalar Tesseract com suporte a idiomas
+brew install tesseract tesseract-lang
+
+# Verificar instalaÃ§Ã£o
+tesseract --version
+```
+
+### 2. Configurar PermissÃµes do Sistema
+
+1. Abra **ConfiguraÃ§Ãµes do Sistema**
+2. VÃ¡ em **Privacidade e SeguranÃ§a**
+3. Clique em **GravaÃ§Ã£o de Tela**
+4. Adicione **Hammerspoon** Ã  lista
+5. **Reinicie o Hammerspoon**
+
+## ðŸ”§ Melhorias Implementadas
+
+### âœ… DetecÃ§Ã£o AutomÃ¡tica de Arquitetura (Melhorada)
+- **Apple Silicon (M1/M2/M3)**: Busca Tesseract em `/opt/homebrew/bin/`
+- **Intel Macs**: Busca Tesseract em `/usr/local/bin/`
+- **Linux**: Busca Tesseract em `/usr/bin/` (para desenvolvimento)
+- **Fallback**: Tenta caminhos alternativos automaticamente via PATH
+
+### âœ… ConfiguraÃ§Ãµes Otimizadas do Tesseract
+- **Idiomas**: PortuguÃªs + InglÃªs (`-l por+eng`)
+- **PSM Mode**: `--psm 6` (bloco uniforme de texto)
+- **OCR Engine**: `--oem 3` (LSTM + Legacy)
+- **Tratamento de Erros**: Mensagens claras e instruÃ§Ãµes de correÃ§Ã£o
+
+### âœ… Fallback Robusto
+- **Primeira opÃ§Ã£o**: Tesseract (mais preciso)
+- **Segunda opÃ§Ã£o**: Vision API nativo do macOS
+- **Tratamento**: Mensagens de erro informativas com soluÃ§Ãµes
+
+### âœ… Suporte Expandido de Formatos
+- **Imagens**: PNG, JPG, JPEG, GIF, BMP, TIFF, WebP
+- **Documentos**: PDF (novo!)
+
+### âœ… Tratamento Correto de CÃ³digos de Retorno (Corrigido)
+- **CÃ³digo 0**: Captura bem-sucedida â†’ **Aguarda 0.3s** â†’ Processa OCR
+- **CÃ³digo 1**: UsuÃ¡rio cancelou (ESC) â†’ Mensagem "Captura cancelada"
+- **Outros cÃ³digos**: Erro real â†’ Mensagem de permissÃ£o e abre configuraÃ§Ãµes
+
+### âœ… Melhorias Adicionais
+- **Feedback visual**: Mensagem "ðŸ” Processando OCR..." durante o processamento
+- **DetecÃ§Ã£o robusta**: Melhor detecÃ§Ã£o de caminhos do Tesseract
+- **Logs de debug**: InformaÃ§Ãµes de erro mais detalhadas no console
+
+### âœ… Workflow Simplificado (CORRIGIDO)
+- **â‡§ âŒƒ âŒ˜ R**: Captura Ã¡rea da tela â†’ **arquivo temporÃ¡rio** â†’ OCR â†’ **texto no clipboard**
+- **â‡§ âŒƒ âŒ˜ F**: OCR direto do que estÃ¡ no clipboard (imagens)
+- **Uso de hs.task**: ExecuÃ§Ã£o assÃ­ncrona sem travamentos
+- **Sem conflitos**: A imagem nÃ£o interfere mais com o texto extraÃ­do
+
+## ðŸš€ Como Usar
+
+### OCR de Ãrea da Tela (â‡§ âŒƒ âŒ˜ R) - CORRIGIDO
+
+1. **Captura e OCR em uma etapa**:
+   - Pressione `â‡§ âŒƒ âŒ˜ R`
+   - Selecione Ã¡rea da tela com texto (cursor em cruz)
+   - Aguarde a mensagem "ðŸ” Processando OCR..."
+   - **Texto Ã© extraÃ­do e copiado automaticamente**
+   - **A imagem NÃƒO fica no clipboard** (problema resolvido!)
+
+### OCR de Imagem no Clipboard (â‡§ âŒƒ âŒ˜ F)
+
+1. Copie qualquer imagem (âŒ˜C) - do Preview, Finder, navegador, etc.
+2. Pressione `â‡§ âŒƒ âŒ˜ F`
+3. Texto da imagem Ã© extraÃ­do e copiado automaticamente
+
+## ðŸ” Teste de ConfiguraÃ§Ã£o
+
+Execute este comando no Terminal para verificar se tudo estÃ¡ configurado:
+
+```bash
+# Verificar Tesseract
+which tesseract && tesseract --version
+
+# Verificar idiomas instalados
+tesseract --list-langs
+```
+
+## âš ï¸ SoluÃ§Ã£o de Problemas
+
+### "OCR falhou ou nenhum texto encontrado"
+
+**Causa**: Tesseract nÃ£o instalado ou nÃ£o encontrado
+
+**SoluÃ§Ã£o**:
+```bash
+brew install tesseract tesseract-lang
+```
+
+### "Falha na captura"
+
+**Causa**: PermissÃµes de gravaÃ§Ã£o de tela nÃ£o configuradas
+
+**SoluÃ§Ã£o**:
+1. ConfiguraÃ§Ãµes â†’ Privacidade â†’ GravaÃ§Ã£o de Tela
+2. Adicionar Hammerspoon
+3. Reiniciar Hammerspoon
+
+### Tesseract nÃ£o encontrado em Apple Silicon
+
+**Causa**: Caminho incorreto
+
+**SoluÃ§Ã£o**: O cÃ³digo agora detecta automaticamente:
+- `/opt/homebrew/bin/tesseract` (Apple Silicon)
+- `/usr/local/bin/tesseract` (Intel)
+
+## ðŸ“Š Recursos TÃ©cnicos
+
+- **DetecÃ§Ã£o automÃ¡tica de arquitetura** (Apple Silicon vs Intel)
+- **MÃºltiplos engines OCR** (Tesseract + Vision API)
+- **ConfiguraÃ§Ãµes otimizadas** para melhor precisÃ£o
+- **Tratamento robusto de erros** com mensagens claras
+- **Suporte a mÃºltiplos formatos** de imagem
+- **OrganizaÃ§Ã£o inteligente de texto** por posiÃ§Ã£o vertical
+
+## âœ¨ Resultado
+
+ApÃ³s as correÃ§Ãµes, os atalhos OCR agora funcionam de forma **estÃ¡vel e confiÃ¡vel** em Macs Apple Silicon com Homebrew, com fallbacks robustos e mensagens de erro informativas.
+
+### ðŸŽ¯ Status Atual (PROBLEMA TOTALMENTE RESOLVIDO)
+- âœ… **Problema principal RESOLVIDO**: `â‡§ âŒƒ âŒ˜ R` agora executa OCR corretamente
+- âœ… **Conflito de clipboard eliminado**: MudanÃ§a para arquivo temporÃ¡rio resolve o problema
+- âœ… **Fluxo otimizado**: Captura â†’ Arquivo â†’ OCR â†’ Texto (sem interferÃªncias)
+- âœ… **DetecÃ§Ã£o melhorada**: Suporte a mÃºltiplas arquiteturas (Mac/Linux)
+- âœ… **Feedback aprimorado**: Mensagens claras durante o processamento
+- âœ… **Limpeza automÃ¡tica**: Arquivos temporÃ¡rios removidos automaticamente
+
+### ðŸ”„ Para aplicar as correÃ§Ãµes:
+1. Recarregue a configuraÃ§Ã£o do Hammerspoon (`âŒ˜ + R` no console do Hammerspoon)
+2. Teste o atalho `â‡§ âŒƒ âŒ˜ R` selecionando uma Ã¡rea com texto
+3. Verifique se a mensagem "ðŸ” Processando OCR..." aparece
+4. **Confirme que apenas o TEXTO Ã© copiado** (nÃ£o a imagem)
+5. Use `âŒ˜ + V` para colar - deve aparecer texto, nÃ£o imagem!







init.lua:


PATCH:

diff --git a/init.lua b/init.lua
--- a/init.lua
+++ b/init.lua
@@ -1,363 +1,415 @@
---------------------------------------------------------------------
--- ðŸ”¨  Hammerspoon â€“ Atalhos Personalizados (12 atalhos)
---------------------------------------------------------------------
--- 1. âŒ˜ I            â†’ Abrir arquivos/URLs/caminhos
--- 2. âŒ˜ J            â†’ Mission Control
--- 3. âŒ˜ âŒ¥ âŒƒ T        â†’ Digital Color Meter
--- 4. âŒ˜ âŒ¥ âŒƒ Q        â†’ Force Quit
--- 5. âŒ˜ âŒ¥ âŒƒ A        â†’ Activity Monitor
--- 6. âŒ˜ âŒ¥ âŒƒ P        â†’ Passwords
--- 7. âŒ˜ âŒ¥ âŒƒ Space    â†’ Show Desktop
--- 8. âŒ˜ â‡§ U / var.   â†’ Encurtador de URLs  (TinyURL / QR / Bit.ly)
--- 9. âŒ˜ â‡§ W          â†’ Copiar caminho do Finder
--- 10. âŒ˜ âŒ¥ âŒƒ R       â†’ Text Replacement (ConfiguraÃ§Ãµes)
--- 11. â‡§ âŒƒ âŒ˜ R       â†’ OCR Reader (captura Ã¡rea da tela)
--- 12. â‡§ âŒƒ âŒ˜ F       â†’ OCR de imagem no clipboard
---------------------------------------------------------------------
-
---------------------------------------------------------------------
--- Helper: diretÃ³rio-pai de um caminho
---------------------------------------------------------------------
-local function parent_dir(p)
-  p = p:gsub("/+$", "")
-  return p:match("(.+)/[^/]+$") or p
-end
-
---------------------------------------------------------------------
--- Helper: valida URL simples
---------------------------------------------------------------------
-local function is_url(u) return u and u:match("^https?://") end
-
---------------------------------------------------------------------
--- Helper: TinyURL (usando curl - mais confiÃ¡vel)
---------------------------------------------------------------------
-local function shorten_tiny(url)
-  local escapedUrl = url:gsub("([^%w%.%-%_])", function(c)
-    return string.format("%%%02X", string.byte(c))
-  end)
-  
-  local cmd = string.format('curl -s "https://tinyurl.com/api-create.php?url=%s"', escapedUrl)
-  local handle = io.popen(cmd)
-  if not handle then return nil end
-  
-  local result = handle:read("*a")
-  handle:close()
-  
-  if result and result ~= "" then
-    return result:gsub("%s+", "") -- trim whitespace
-  end
-  return nil
-end
-
---------------------------------------------------------------------
--- Helper: Bit.ly  (adicione seu token se quiser)
---------------------------------------------------------------------
-local BITLY_TOKEN = nil   -- coloque aqui se tiver â†’ "xxxxxxxxxxxxxxxxxxxx"
-local function shorten_bitly(url)
-  if not BITLY_TOKEN then return nil,"token ausente" end
-  local body = string.format('{"long_url":"%s"}', url)
-  local hdrs = {
-    ["Authorization"] = "Bearer " .. BITLY_TOKEN,
-    ["Content-Type"]  = "application/json"
-  }
-  local ok, res = hs.http.doRequest(
-        "https://api-ssl.bitly.com/v4/shorten", "POST", body, hdrs)
-  local link = res and res:match('%"link"%s*:%s*%"([^"]+)"')
-  return ok and link or nil
-end
-
---------------------------------------------------------------------
--- Helper: gera QR-Code no navegador
---------------------------------------------------------------------
-local function open_qr(url)
-  local escapedUrl = url:gsub("([^%w%.%-%_])", function(c)
-    return string.format("%%%02X", string.byte(c))
-  end)
-  local qrUrl = string.format("https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=%s", escapedUrl)
-  hs.execute(string.format('open "%s"', qrUrl))
-end
-
---------------------------------------------------------------------
--- SECTION 1 â”€ Abrir arquivos / URLs  (âŒ˜ I)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd"}, "i", function()
-  hs.eventtap.keyStroke({"cmd"}, "c")
-  hs.timer.doAfter(0.3, function()
-    local sel = hs.pasteboard.getContents()
-    if sel and sel~="" then
-      sel = sel:match("^%s*(.-)%s*$"):gsub("^file://","")
-      if hs.fs.attributes(sel) then           -- caminho vÃ¡lido
-        if hs.fs.attributes(sel).mode~="directory" then sel = parent_dir(sel) end
-        hs.execute('open "'..sel..'"'); hs.alert("ðŸ“‚ "..sel); return
-      end
-      if is_url(sel) or sel:match("^www%.") then
-        hs.execute('open "'..sel..'"'); hs.alert("ðŸŒ "..sel); return
-      end
-    end
-    local script=[[
-      tell application "Finder"
-        if (count of selection)=0 then return ""
-        POSIX path of (item 1 of selection as alias)
-      end tell]]
-    local ok,res=hs.osascript.applescript(script)
-    if ok and res~="" then hs.execute('open "'..res..'"')
-    else hs.alert("âš ï¸ Nada selecionado") end
-  end)
-end)
-
---------------------------------------------------------------------
--- SECTION 2 â”€ Mission Control  (âŒ˜ J)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd"}, "j",
-  function() hs.execute("open -b com.apple.exposelauncher"); hs.alert("ðŸ“± Mission Control") end)
-
---------------------------------------------------------------------
--- SECTION 3 â”€ Digital Color Meter  (âŒ˜ âŒ¥ âŒƒ T)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","alt","ctrl"}, "t",
-  function() hs.execute([[osascript -e 'tell application "Digital Color Meter" to activate']])
-           hs.alert("ðŸŽ¨ Digital Color Meter") end)
-
---------------------------------------------------------------------
--- SECTION 4 â”€ Force Quit  (âŒ˜ âŒ¥ âŒƒ Q)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","alt","ctrl"}, "q", function()
-  -- MÃ©todo mais confiÃ¡vel para Force Quit
-  hs.execute([[osascript -e 'tell application "System Events" to key code 53 using {command down, option down}']])
-  hs.alert("ðŸ’€ Force Quit Applications")
-end)
-
---------------------------------------------------------------------
--- SECTION 5 â”€ Activity Monitor  (âŒ˜ âŒ¥ âŒƒ A)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","alt","ctrl"}, "a",
-  function() hs.execute("open -a 'Activity Monitor'"); hs.alert("ðŸ“Š Activity Monitor") end)
-
---------------------------------------------------------------------
--- SECTION 6 â”€ Passwords  (âŒ˜ âŒ¥ âŒƒ P)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","alt","ctrl"}, "p",
-  function() hs.execute("open -a 'Passwords'"); hs.alert("ðŸ” Passwords") end)
-
---------------------------------------------------------------------
--- SECTION 7 â”€ Show Desktop  (âŒ˜ âŒ¥ âŒƒ Space)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","alt","ctrl"}, "space", function()
-  -- Tenta F11 e depois fn+F11; em seguida, fallback para ocultar outros apps
-  local function tryF11()
-    hs.eventtap.keyStroke({}, "F11", 0)
-    hs.timer.doAfter(0.12, function() hs.eventtap.keyStroke({"fn"}, "F11", 0) end)
-  end
-  local function hideOthers()
-    local front = hs.application.frontmostApplication()
-    if front then
-      front:hideOthers()
-    else
-      for _, app in ipairs(hs.application.runningApplications()) do
-        if app:bundleID() ~= "com.apple.finder" then app:hide() end
-      end
-    end
-  end
-  pcall(tryF11)
-  hs.timer.doAfter(0.25, function() hideOthers() end)
-  hs.alert("ðŸ–¥ï¸ Show Desktop")
-end)
-
---------------------------------------------------------------------
--- SECTION 8 â”€ URL Shortener  (âŒ˜ â‡§ U  / var.)
---------------------------------------------------------------------
--- âŒ˜ â‡§ U  â†’ TinyURL
-hs.hotkey.bind({"cmd","shift"}, "u", function()
-  hs.eventtap.keyStroke({"cmd"}, "c")
-  hs.timer.doAfter(0.3, function()
-    local url = hs.pasteboard.getContents()
-    if not is_url(url) then return hs.alert("âš ï¸ Selecione URL vÃ¡lida") end
-    hs.alert("ðŸ”„ Encurtandoâ€¦")
-    local s = shorten_tiny(url)
-    if s then hs.pasteboard.setContents(s); hs.alert("ðŸ”— Copiado!\n"..s,3)
-    else     hs.alert("âŒ TinyURL falhou") end
-  end)
-end)
-
--- âŒ˜ â‡§ âŒ¥ U  â†’ TinyURL + QR
-hs.hotkey.bind({"cmd","shift","alt"}, "u", function()
-  hs.eventtap.keyStroke({"cmd"}, "c")
-  hs.timer.doAfter(0.3, function()
-    local url = hs.pasteboard.getContents()
-    if not is_url(url) then return hs.alert("âš ï¸ Selecione URL vÃ¡lida") end
-    hs.alert("ðŸ”„ Encurtandoâ€¦")
-    local s = shorten_tiny(url)
-    if s then
-      hs.pasteboard.setContents(s)
-      hs.alert("ðŸ”— Copiado!\n"..s,3)
-      hs.timer.doAfter(1, function() open_qr(s) end)
-    else hs.alert("âŒ TinyURL falhou") end
-  end)
-end)
-
--- âŒ˜ â‡§ âŒƒ U  â†’ Bit.ly
-hs.hotkey.bind({"cmd","shift","ctrl"}, "u", function()
-  if not BITLY_TOKEN then return hs.alert("âš ï¸ Configure BITLY_TOKEN") end
-  hs.eventtap.keyStroke({"cmd"}, "c")
-  hs.timer.doAfter(0.3, function()
-    local url = hs.pasteboard.getContents()
-    if not is_url(url) then return hs.alert("âš ï¸ Selecione URL vÃ¡lida") end
-    hs.alert("ðŸ”„ Encurtando (Bit.ly)â€¦")
-    local s,err = shorten_bitly(url)
-    if s then hs.pasteboard.setContents(s); hs.alert("ðŸ”— Copiado!\n"..s,3)
-    else     hs.alert("âŒ Bit.ly erro: "..(err or "?")) end
-  end)
-end)
-
---------------------------------------------------------------------
--- SECTION 9 â”€ Copiar Caminho do Finder  (âŒ˜ â‡§ W)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","shift"}, "w", function()
-  local script = [[
-    tell application "Finder"
-      set sel to selection
-      if sel is {} then
-        -- Se nada selecionado, pega a pasta atual
-        set currentFolder to target of front window
-        return POSIX path of (currentFolder as alias)
-      else
-        -- Se algo selecionado, pega o primeiro item
-        set theItem to item 1 of sel
-        return POSIX path of (theItem as alias)
-      end if
-    end tell
-  ]]
-  
-  local ok, result = hs.osascript.applescript(script)
-  if ok and result ~= "" then
-    result = result:match("^%s*(.-)%s*$")  -- trim whitespace
-    hs.pasteboard.setContents(result)
-    hs.alert("ðŸ“‹ Caminho copiado!\n" .. result, 3)
-  else
-    hs.alert("âš ï¸ Erro ao obter caminho do Finder")
-  end
-end)
-
---------------------------------------------------------------------
--- SECTION 10 â”€ Text Replacement (ConfiguraÃ§Ãµes)  (âŒ˜ âŒ¥ âŒƒ R)
---------------------------------------------------------------------
-hs.hotkey.bind({"cmd","alt","ctrl"}, "r", function()
-  -- Abre diretamente o painel Text Replacement nas ConfiguraÃ§Ãµes do Sistema
-  hs.execute("open 'x-apple.systempreferences:com.apple.preference.keyboard?Text'")
-  hs.alert("âŒ¨ï¸ Text Replacement")
-end)
-
---------------------------------------------------------------------
--- SECTION 11 â”€ OCR Reader  (â‡§ âŒƒ âŒ˜ R e â‡§ âŒƒ âŒ˜ F)
---------------------------------------------------------------------
--- OCR simples: captura â†’ clipboard â†’ OCR
---------------------------------------------------------------------
-local OCR_LANGS = "por+eng"
-
-local function have(cmd)
-  local ok,_,_,rc = hs.execute('command -v '..cmd..' >/dev/null 2>&1; echo $?')
-  return ok and rc=="0\n"
-end
-
-local function ocrClipboard()
-  local img = hs.image.imageFromClipboard()
-  if not img then
-    hs.alert("âš ï¸ Sem imagem no clipboard")
-    return
-  end
-  local tmp = (os.getenv("TMPDIR") or "/tmp") .. "/hsp_clip_ocr.png"
-  os.remove(tmp)
-  img:saveToFile(tmp)
-
-  if have("tesseract") then
-    local out = {}
-    -- Detecta caminho do Tesseract automaticamente
-    local tesseractPath = "/opt/homebrew/bin/tesseract"  -- Apple Silicon
-    if not have("tesseract") or not hs.fs.attributes(tesseractPath) then
-      tesseractPath = "/usr/local/bin/tesseract"  -- Intel Mac
-      if not hs.fs.attributes(tesseractPath) then
-        tesseractPath = "tesseract"  -- PATH
-      end
-    end
-    
-    local t = hs.task.new(tesseractPath, function(exitCode, stdout, stderr)
-      os.remove(tmp)
-      local result = table.concat(out)
-      result = result:gsub("^%s*(.-)%s*$","%1"):gsub("\n\n+","\n\n")
-      if exitCode==0 and result~="" then
-        hs.pasteboard.setContents(result)
-        hs.alert("âœ… OCR copiado do clipboard")
-        print("=== OCR (tesseract) ===\n"..result.."\n=======================")
-      else
-        hs.alert("âŒ OCR vazio/falhou (tesseract)")
-      end
-    end, {tmp, "stdout", "-l", OCR_LANGS})
-    t:setStdoutCallback(function(_, data) table.insert(out, data or "") end)
-    t:start()
-  else
-    -- Fallback: Vision via Python (se tiver PyObjC)
-    local py = [[
-import sys,Foundation,Quartz,Vision
-from Cocoa import NSURL
-p = sys.argv[1]
-url = Foundation.NSURL.fileURLWithPath_(p)
-img = Quartz.CIImage.imageWithContentsOfURL_(url)
-req = Vision.VNRecognizeTextRequest.new()
-req.setRecognitionLevel_(Vision.VNRequestTextRecognitionLevelAccurate)
-req.setUsesLanguageCorrection_(True)
-h = Vision.VNImageRequestHandler.alloc().initWithCIImage_options_(img,{})
-ok = h.performRequests_error_([req], None)
-res=[]
-if ok[0]:
-    for o in req.results() or []:
-        c = o.topCandidates_(1)
-        if c and len(c)>0: res.append(c[0].string())
-print("\\n".join(res))
-]]
-    local out = {}
-    local t = hs.task.new("/usr/bin/python3", function(exitCode, stdout, stderr)
-      os.remove(tmp)
-      local result = table.concat(out)
-      result = result:gsub("^%s*(.-)%s*$","%1"):gsub("\n\n+","\n\n")
-      if exitCode==0 and result~="" then
-        hs.pasteboard.setContents(result)
-        hs.alert("âœ… OCR copiado (Vision)")
-      else
-        hs.alert("âŒ OCR falhou (Vision). Instale tesseract: brew install tesseract")
-      end
-    end, {"-c", py, tmp})
-    t:setStdoutCallback(function(_, data) table.insert(out, data or "") end)
-    t:start()
-  end
-end
-
-local function captureToClipboardThenOCR()
-  -- Captura interativa PARA O CLIPBOARD (sem arquivo): -i -c
-  local t = hs.task.new("/usr/sbin/screencapture", function(exitCode)
-    if exitCode==0 then
-      -- Agora OCR do que estiver no clipboard
-      ocrClipboard()
-    elseif exitCode==1 then
-      hs.alert("âŒ Captura cancelada")
-    else
-      hs.alert("âš ï¸ Falha na captura. DÃª permissÃ£o em Privacidade > Screen Recording p/ Hammerspoon")
-      hs.timer.doAfter(0.8, function()
-        hs.execute('open "x-apple.systempreferences:com.apple.preference.security?Privacy_ScreenCapture"')
-      end)
-    end
-  end, {"-i","-c"})
-  t:start()
-end
-
---------------------------------------------------------------------
--- Atalhos
---------------------------------------------------------------------
--- â‡§ âŒƒ âŒ˜ R â†’ Selecionar Ã¡rea â†’ copiar para clipboard â†’ OCR
-hs.hotkey.bind({"shift","ctrl","cmd"}, "r", captureToClipboardThenOCR)
-
--- â‡§ âŒƒ âŒ˜ F â†’ OCR do que jÃ¡ estiver no clipboard (ex.: vocÃª copiou uma imagem do Preview/Finder)
-hs.hotkey.bind({"shift","ctrl","cmd"}, "f", ocrClipboard)
-
---------------------------------------------------------------------
-hs.alert("ðŸ”¨ Atalhos Hammerspoon carregados! (12 ativos)")
---------------------------------------------------------------------
+--------------------------------------------------------------------
+-- ðŸ”¨  Hammerspoon â€“ Atalhos Personalizados (12 atalhos)
+--------------------------------------------------------------------
+-- 1. âŒ˜ I            â†’ Abrir arquivos/URLs/caminhos
+-- 2. âŒ˜ J            â†’ Mission Control
+-- 3. âŒ˜ âŒ¥ âŒƒ T        â†’ Digital Color Meter
+-- 4. âŒ˜ âŒ¥ âŒƒ Q        â†’ Force Quit
+-- 5. âŒ˜ âŒ¥ âŒƒ A        â†’ Activity Monitor
+-- 6. âŒ˜ âŒ¥ âŒƒ P        â†’ Passwords
+-- 7. âŒ˜ âŒ¥ âŒƒ Space    â†’ Show Desktop
+-- 8. âŒ˜ â‡§ U / var.   â†’ Encurtador de URLs  (TinyURL / QR / Bit.ly)
+-- 9. âŒ˜ â‡§ W          â†’ Copiar caminho do Finder
+-- 10. âŒ˜ âŒ¥ âŒƒ R       â†’ Text Replacement (ConfiguraÃ§Ãµes)
+-- 11. â‡§ âŒƒ âŒ˜ R       â†’ OCR Reader (captura Ã¡rea da tela)
+-- 12. â‡§ âŒƒ âŒ˜ F       â†’ OCR de imagem no clipboard
+--------------------------------------------------------------------
+
+--------------------------------------------------------------------
+-- Helper: diretÃ³rio-pai de um caminho
+--------------------------------------------------------------------
+local function parent_dir(p)
+  p = p:gsub("/+$", "")
+  return p:match("(.+)/[^/]+$") or p
+end
+
+--------------------------------------------------------------------
+-- Helper: valida URL simples
+--------------------------------------------------------------------
+local function is_url(u) return u and u:match("^https?://") end
+
+--------------------------------------------------------------------
+-- Helper: TinyURL (usando curl - mais confiÃ¡vel)
+--------------------------------------------------------------------
+local function shorten_tiny(url)
+  local escapedUrl = url:gsub("([^%w%.%-%_])", function(c)
+    return string.format("%%%02X", string.byte(c))
+  end)
+  
+  local cmd = string.format('curl -s "https://tinyurl.com/api-create.php?url=%s"', escapedUrl)
+  local handle = io.popen(cmd)
+  if not handle then return nil end
+  
+  local result = handle:read("*a")
+  handle:close()
+  
+  if result and result ~= "" then
+    return result:gsub("%s+", "") -- trim whitespace
+  end
+  return nil
+end
+
+--------------------------------------------------------------------
+-- Helper: Bit.ly  (adicione seu token se quiser)
+--------------------------------------------------------------------
+local BITLY_TOKEN = nil   -- coloque aqui se tiver â†’ "xxxxxxxxxxxxxxxxxxxx"
+local function shorten_bitly(url)
+  if not BITLY_TOKEN then return nil,"token ausente" end
+  local body = string.format('{"long_url":"%s"}', url)
+  local hdrs = {
+    ["Authorization"] = "Bearer " .. BITLY_TOKEN,
+    ["Content-Type"]  = "application/json"
+  }
+  local ok, res = hs.http.doRequest(
+        "https://api-ssl.bitly.com/v4/shorten", "POST", body, hdrs)
+  local link = res and res:match('%"link"%s*:%s*%"([^"]+)"')
+  return ok and link or nil
+end
+
+--------------------------------------------------------------------
+-- Helper: gera QR-Code no navegador
+--------------------------------------------------------------------
+local function open_qr(url)
+  local escapedUrl = url:gsub("([^%w%.%-%_])", function(c)
+    return string.format("%%%02X", string.byte(c))
+  end)
+  local qrUrl = string.format("https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=%s", escapedUrl)
+  hs.execute(string.format('open "%s"', qrUrl))
+end
+
+--------------------------------------------------------------------
+-- SECTION 1 â”€ Abrir arquivos / URLs  (âŒ˜ I)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd"}, "i", function()
+  hs.eventtap.keyStroke({"cmd"}, "c")
+  hs.timer.doAfter(0.3, function()
+    local sel = hs.pasteboard.getContents()
+    if sel and sel~="" then
+      sel = sel:match("^%s*(.-)%s*$"):gsub("^file://","")
+      if hs.fs.attributes(sel) then           -- caminho vÃ¡lido
+        if hs.fs.attributes(sel).mode~="directory" then sel = parent_dir(sel) end
+        hs.execute('open "'..sel..'"'); hs.alert("ðŸ“‚ "..sel); return
+      end
+      if is_url(sel) or sel:match("^www%.") then
+        hs.execute('open "'..sel..'"'); hs.alert("ðŸŒ "..sel); return
+      end
+    end
+    local script=[[
+      tell application "Finder"
+        if (count of selection)=0 then return ""
+        POSIX path of (item 1 of selection as alias)
+      end tell]]
+    local ok,res=hs.osascript.applescript(script)
+    if ok and res~="" then hs.execute('open "'..res..'"')
+    else hs.alert("âš ï¸ Nada selecionado") end
+  end)
+end)
+
+--------------------------------------------------------------------
+-- SECTION 2 â”€ Mission Control  (âŒ˜ J)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd"}, "j",
+  function() hs.execute("open -b com.apple.exposelauncher"); hs.alert("ðŸ“± Mission Control") end)
+
+--------------------------------------------------------------------
+-- SECTION 3 â”€ Digital Color Meter  (âŒ˜ âŒ¥ âŒƒ T)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","alt","ctrl"}, "t",
+  function() hs.execute([[osascript -e 'tell application "Digital Color Meter" to activate']])
+           hs.alert("ðŸŽ¨ Digital Color Meter") end)
+
+--------------------------------------------------------------------
+-- SECTION 4 â”€ Force Quit  (âŒ˜ âŒ¥ âŒƒ Q)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","alt","ctrl"}, "q", function()
+  -- MÃ©todo mais confiÃ¡vel para Force Quit
+  hs.execute([[osascript -e 'tell application "System Events" to key code 53 using {command down, option down}']])
+  hs.alert("ðŸ’€ Force Quit Applications")
+end)
+
+--------------------------------------------------------------------
+-- SECTION 5 â”€ Activity Monitor  (âŒ˜ âŒ¥ âŒƒ A)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","alt","ctrl"}, "a",
+  function() hs.execute("open -a 'Activity Monitor'"); hs.alert("ðŸ“Š Activity Monitor") end)
+
+--------------------------------------------------------------------
+-- SECTION 6 â”€ Passwords  (âŒ˜ âŒ¥ âŒƒ P)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","alt","ctrl"}, "p",
+  function() hs.execute("open -a 'Passwords'"); hs.alert("ðŸ” Passwords") end)
+
+--------------------------------------------------------------------
+-- SECTION 7 â”€ Show Desktop  (âŒ˜ âŒ¥ âŒƒ Space)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","alt","ctrl"}, "space", function()
+  -- Tenta F11 e depois fn+F11; em seguida, fallback para ocultar outros apps
+  local function tryF11()
+    hs.eventtap.keyStroke({}, "F11", 0)
+    hs.timer.doAfter(0.12, function() hs.eventtap.keyStroke({"fn"}, "F11", 0) end)
+  end
+  local function hideOthers()
+    local front = hs.application.frontmostApplication()
+    if front then
+      front:hideOthers()
+    else
+      for _, app in ipairs(hs.application.runningApplications()) do
+        if app:bundleID() ~= "com.apple.finder" then app:hide() end
+      end
+    end
+  end
+  pcall(tryF11)
+  hs.timer.doAfter(0.25, function() hideOthers() end)
+  hs.alert("ðŸ–¥ï¸ Show Desktop")
+end)
+
+--------------------------------------------------------------------
+-- SECTION 8 â”€ URL Shortener  (âŒ˜ â‡§ U  / var.)
+--------------------------------------------------------------------
+-- âŒ˜ â‡§ U  â†’ TinyURL
+hs.hotkey.bind({"cmd","shift"}, "u", function()
+  hs.eventtap.keyStroke({"cmd"}, "c")
+  hs.timer.doAfter(0.3, function()
+    local url = hs.pasteboard.getContents()
+    if not is_url(url) then return hs.alert("âš ï¸ Selecione URL vÃ¡lida") end
+    hs.alert("ðŸ”„ Encurtandoâ€¦")
+    local s = shorten_tiny(url)
+    if s then hs.pasteboard.setContents(s); hs.alert("ðŸ”— Copiado!\n"..s,3)
+    else     hs.alert("âŒ TinyURL falhou") end
+  end)
+end)
+
+-- âŒ˜ â‡§ âŒ¥ U  â†’ TinyURL + QR
+hs.hotkey.bind({"cmd","shift","alt"}, "u", function()
+  hs.eventtap.keyStroke({"cmd"}, "c")
+  hs.timer.doAfter(0.3, function()
+    local url = hs.pasteboard.getContents()
+    if not is_url(url) then return hs.alert("âš ï¸ Selecione URL vÃ¡lida") end
+    hs.alert("ðŸ”„ Encurtandoâ€¦")
+    local s = shorten_tiny(url)
+    if s then
+      hs.pasteboard.setContents(s)
+      hs.alert("ðŸ”— Copiado!\n"..s,3)
+      hs.timer.doAfter(1, function() open_qr(s) end)
+    else hs.alert("âŒ TinyURL falhou") end
+  end)
+end)
+
+-- âŒ˜ â‡§ âŒƒ U  â†’ Bit.ly
+hs.hotkey.bind({"cmd","shift","ctrl"}, "u", function()
+  if not BITLY_TOKEN then return hs.alert("âš ï¸ Configure BITLY_TOKEN") end
+  hs.eventtap.keyStroke({"cmd"}, "c")
+  hs.timer.doAfter(0.3, function()
+    local url = hs.pasteboard.getContents()
+    if not is_url(url) then return hs.alert("âš ï¸ Selecione URL vÃ¡lida") end
+    hs.alert("ðŸ”„ Encurtando (Bit.ly)â€¦")
+    local s,err = shorten_bitly(url)
+    if s then hs.pasteboard.setContents(s); hs.alert("ðŸ”— Copiado!\n"..s,3)
+    else     hs.alert("âŒ Bit.ly erro: "..(err or "?")) end
+  end)
+end)
+
+--------------------------------------------------------------------
+-- SECTION 9 â”€ Copiar Caminho do Finder  (âŒ˜ â‡§ W)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","shift"}, "w", function()
+  local script = [[
+    tell application "Finder"
+      set sel to selection
+      if sel is {} then
+        -- Se nada selecionado, pega a pasta atual
+        set currentFolder to target of front window
+        return POSIX path of (currentFolder as alias)
+      else
+        -- Se algo selecionado, pega o primeiro item
+        set theItem to item 1 of sel
+        return POSIX path of (theItem as alias)
+      end if
+    end tell
+  ]]
+  
+  local ok, result = hs.osascript.applescript(script)
+  if ok and result ~= "" then
+    result = result:match("^%s*(.-)%s*$")  -- trim whitespace
+    hs.pasteboard.setContents(result)
+    hs.alert("ðŸ“‹ Caminho copiado!\n" .. result, 3)
+  else
+    hs.alert("âš ï¸ Erro ao obter caminho do Finder")
+  end
+end)
+
+--------------------------------------------------------------------
+-- SECTION 10 â”€ Text Replacement (ConfiguraÃ§Ãµes)  (âŒ˜ âŒ¥ âŒƒ R)
+--------------------------------------------------------------------
+hs.hotkey.bind({"cmd","alt","ctrl"}, "r", function()
+  -- Abre diretamente o painel Text Replacement nas ConfiguraÃ§Ãµes do Sistema
+  hs.execute("open 'x-apple.systempreferences:com.apple.preference.keyboard?Text'")
+  hs.alert("âŒ¨ï¸ Text Replacement")
+end)
+
+--------------------------------------------------------------------
+-- SECTION 11 â”€ OCR Reader  (â‡§ âŒƒ âŒ˜ R e â‡§ âŒƒ âŒ˜ F)
+--------------------------------------------------------------------
+-- OCR simples: captura â†’ clipboard â†’ OCR
+--------------------------------------------------------------------
+local OCR_LANGS = "por+eng"
+
+local function have(cmd)
+  local ok,_,_,rc = hs.execute('command -v '..cmd..' >/dev/null 2>&1; echo $?')
+  return ok and rc=="0\n"
+end
+
+local function ocrFromImage(img, imagePath)
+  if not img then
+    hs.alert("âš ï¸ Imagem invÃ¡lida")
+    return
+  end
+  
+  hs.alert("ðŸ” Processando OCR...")
+  local tmp = imagePath or ((os.getenv("TMPDIR") or "/tmp") .. "/hsp_ocr_temp.png")
+  
+  -- Se nÃ£o foi fornecido um caminho, salva a imagem
+  if not imagePath then
+    os.remove(tmp)
+    img:saveToFile(tmp)
+  end
+
+  -- Detecta caminho do Tesseract automaticamente
+  local tesseractPath = nil
+  local possiblePaths = {
+    "/opt/homebrew/bin/tesseract",  -- Apple Silicon Mac
+    "/usr/local/bin/tesseract",     -- Intel Mac
+    "/usr/bin/tesseract",           -- Linux
+    "tesseract"                     -- PATH
+  }
+  
+  for _, path in ipairs(possiblePaths) do
+    if path == "tesseract" then
+      if have("tesseract") then
+        tesseractPath = path
+        break
+      end
+    else
+      if hs.fs.attributes(path) then
+        tesseractPath = path
+        break
+      end
+    end
+  end
+  
+  if tesseractPath then
+    local out = {}
+    
+    local t = hs.task.new(tesseractPath, function(exitCode, stdout, stderr)
+      -- Remove arquivo temporÃ¡rio se foi fornecido externamente (captura de tela)
+      if imagePath then
+        os.remove(tmp)
+      end
+      local result = table.concat(out)
+      result = result:gsub("^%s*(.-)%s*$","%1"):gsub("\n\n+","\n\n")
+      if exitCode==0 and result~="" then
+        hs.pasteboard.setContents(result)
+        hs.alert("âœ… OCR copiado!")
+        print("=== OCR (tesseract) ===\n"..result.."\n=======================")
+      else
+        hs.alert("âŒ OCR vazio/falhou (tesseract)")
+        print("OCR Error - Exit code: " .. exitCode .. ", stderr: " .. (stderr or ""))
+      end
+    end, {tmp, "stdout", "-l", OCR_LANGS})
+    t:setStdoutCallback(function(_, data) table.insert(out, data or "") end)
+    t:start()
+  else
+    hs.alert("âŒ Tesseract nÃ£o encontrado. Instale: brew install tesseract")
+    -- Fallback: Vision via Python (se tiver PyObjC)
+    local py = [[
+import sys,Foundation,Quartz,Vision
+from Cocoa import NSURL
+p = sys.argv[1]
+url = Foundation.NSURL.fileURLWithPath_(p)
+img = Quartz.CIImage.imageWithContentsOfURL_(url)
+req = Vision.VNRecognizeTextRequest.new()
+req.setRecognitionLevel_(Vision.VNRequestTextRecognitionLevelAccurate)
+req.setUsesLanguageCorrection_(True)
+h = Vision.VNImageRequestHandler.alloc().initWithCIImage_options_(img,{})
+ok = h.performRequests_error_([req], None)
+res=[]
+if ok[0]:
+    for o in req.results() or []:
+        c = o.topCandidates_(1)
+        if c and len(c)>0: res.append(c[0].string())
+print("\\n".join(res))
+]]
+    local out = {}
+    local t = hs.task.new("/usr/bin/python3", function(exitCode, stdout, stderr)
+      -- Remove arquivo temporÃ¡rio se foi fornecido externamente (captura de tela)
+      if imagePath then
+        os.remove(tmp)
+      end
+      local result = table.concat(out)
+      result = result:gsub("^%s*(.-)%s*$","%1"):gsub("\n\n+","\n\n")
+      if exitCode==0 and result~="" then
+        hs.pasteboard.setContents(result)
+        hs.alert("âœ… OCR copiado (Vision)")
+      else
+        hs.alert("âŒ OCR falhou (Vision). Instale tesseract: brew install tesseract")
+      end
+    end, {"-c", py, tmp})
+    t:setStdoutCallback(function(_, data) table.insert(out, data or "") end)
+    t:start()
+  end
+end
+
+local function ocrClipboard()
+  local img = hs.image.imageFromClipboard()
+  if not img then
+    hs.alert("âš ï¸ Sem imagem no clipboard")
+    return
+  end
+  ocrFromImage(img)
+end
+
+local function captureToFileThenOCR()
+  -- Captura interativa para arquivo temporÃ¡rio (nÃ£o clipboard): -i
+  local tmp = (os.getenv("TMPDIR") or "/tmp") .. "/hsp_screen_capture.png"
+  os.remove(tmp) -- Remove arquivo anterior se existir
+  
+  local t = hs.task.new("/usr/sbin/screencapture", function(exitCode)
+    if exitCode==0 then
+      -- Carrega a imagem do arquivo e faz OCR
+      hs.timer.doAfter(0.1, function()
+        local img = hs.image.imageFromPath(tmp)
+        if img then
+          -- Passa o caminho do arquivo para que seja removido apÃ³s o OCR
+          ocrFromImage(img, tmp)
+        else
+          hs.alert("âŒ Erro ao carregar imagem capturada")
+          os.remove(tmp)
+        end
+      end)
+    elseif exitCode==1 then
+      hs.alert("âŒ Captura cancelada")
+      os.remove(tmp)
+    else
+      hs.alert("âš ï¸ Falha na captura. DÃª permissÃ£o em Privacidade > Screen Recording p/ Hammerspoon")
+      os.remove(tmp)
+      hs.timer.doAfter(0.8, function()
+        hs.execute('open "x-apple.systempreferences:com.apple.preference.security?Privacy_ScreenCapture"')
+      end)
+    end
+  end, {"-i", tmp})
+  t:start()
+end
+
+--------------------------------------------------------------------
+-- Atalhos
+--------------------------------------------------------------------
+-- â‡§ âŒƒ âŒ˜ R â†’ Selecionar Ã¡rea â†’ salvar em arquivo â†’ OCR
+hs.hotkey.bind({"shift","ctrl","cmd"}, "r", captureToFileThenOCR)
+
+-- â‡§ âŒƒ âŒ˜ F â†’ OCR do que jÃ¡ estiver no clipboard (ex.: vocÃª copiou uma imagem do Preview/Finder)
+hs.hotkey.bind({"shift","ctrl","cmd"}, "f", ocrClipboard)
+
+--------------------------------------------------------------------
+hs.alert("ðŸ”¨ Atalhos Hammerspoon carregados! (12 ativos)")
+--------------------------------------------------------------------
+